<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Criar Nova Senha - Droga +</title>

        <link rel="icon" type="image/x-icon" href="assets/logo.png" />

        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />

        <style>
            body {
                background-color: #f8f9fa;
                min-height: 100vh;
                display: flex;
                flex-direction: column;
            }

            .navbar {
                background-color: white !important;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }

            .logo-brand {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .logo-brand img {
                height: 40px;
            }

            .main-container {
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 40px 20px;
            }

            .reset-password-card {
                background: white;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                padding: 40px;
                max-width: 500px;
                width: 100%;
            }

            .reset-password-card h2 {
                color: #333;
                font-size: 24px;
                font-weight: 600;
                margin-bottom: 10px;
                text-align: center;
            }

            .reset-password-card .subtitle {
                color: #666;
                font-size: 14px;
                margin-bottom: 30px;
                text-align: center;
            }

            .form-label {
                color: #333;
                font-size: 14px;
                font-weight: 500;
                margin-bottom: 8px;
            }

            .form-control {
                border: 1px solid #ddd;
                border-radius: 4px;
                padding: 12px;
                font-size: 14px;
                background-color: #f5f5f5;
            }

            .form-control:focus {
                background-color: white;
                border-color: #007bff;
                box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.15);
            }

            .info-text {
                color: #666;
                font-size: 13px;
                margin-top: 10px;
                margin-bottom: 25px;
            }

            .radio-option {
                border: 2px solid #ddd;
                border-radius: 8px;
                padding: 15px 20px;
                margin-bottom: 15px;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 15px;
            }

            .radio-option:hover {
                border-color: #007bff;
                background-color: #f8f9ff;
            }

            .radio-option.selected {
                border-color: #007bff;
                background-color: #f0f7ff;
            }

            .radio-option input[type="radio"] {
                width: 20px;
                height: 20px;
                cursor: pointer;
            }

            .radio-option label {
                margin: 0;
                cursor: pointer;
                flex: 1;
                font-size: 15px;
                color: #333;
            }

            .btn-continue {
                background-color: #e0e0e0;
                color: #999;
                border: none;
                border-radius: 25px;
                padding: 12px;
                font-size: 16px;
                font-weight: 500;
                width: 100%;
                margin-top: 20px;
                cursor: not-allowed;
                transition: all 0.3s ease;
            }

            .btn-continue.active {
                background-color: #007bff;
                color: white;
                cursor: pointer;
            }

            .btn-continue.active:hover {
                background-color: #0056b3;
            }

            .btn-back {
                background-color: white;
                color: #333;
                border: 1px solid #ddd;
                border-radius: 25px;
                padding: 12px;
                font-size: 16px;
                font-weight: 500;
                width: 100%;
                margin-top: 15px;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .btn-back:hover {
                background-color: #f8f9fa;
                border-color: #999;
            }

            .header-info {
                display: flex;
                align-items: center;
                gap: 20px;
                font-size: 14px;
                color: #666;
            }

            .header-info i {
                font-size: 18px;
            }

            .form-control.is-invalid {
                border-color: #dc3545;
                background-color: #fff5f5;
            }

            .text-danger {
                color: #dc3545;
            
                .reset-password-card {
                    padding: 30px 20px;
                }

                .header-info {
                    flex-direction: column;
                    gap: 10px;
                }
            }
        </style>
    </head>
    <body>

        <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container px-4 px-lg-5">
                <div class="logo-brand">
                    <img src="assets/logo.png" alt="Droga +" onerror="this.style.display='none'">
                    <a class="navbar-brand" href="index.html">Droga +</a>
                </div>
                
                <div class="ms-auto header-info d-none d-lg-flex">
                    <div>
                        <i class="bi bi-headset"></i>
                        <span>Central de atendimento</span>
                    </div>
                    <div>
                        <i class="bi bi-shield-check"></i>
                        <span>Ambiente 100% seguro</span>
                    </div>
                </div>
            </div>
        </nav>

        <div class="main-container">
            <div class="reset-password-card">
                <h2>Criar uma nova senha</h2>
                <p class="subtitle">Insira o CPF cadastrado para continuar</p>

                <form id="resetPasswordForm">
                    <div class="mb-3">
                        <label for="cpf" class="form-label">CPF</label>
                        <input type="text" class="form-control" id="cpf" placeholder="000.000.000-00" maxlength="14">
                    </div>

                    <p class="info-text">Vamos enviar um código para seu meio de contato cadastrado. Escolha como quer receber:</p>

                    <div class="radio-options">
                        <div class="radio-option" id="smsOption">
                            <input type="radio" name="contactMethod" id="sms" value="sms">
                            <label for="sms">Por SMS</label>
                        </div>

                        <div class="radio-option" id="emailOption">
                            <input type="radio" name="contactMethod" id="email" value="email">
                            <label for="email">Por e-mail</label>
                        </div>
                    </div>

                    <button type="submit" class="btn-continue" id="continueBtn" disabled>Continuar</button>
                    <button type="button" class="btn-back" onclick="window.location.href='login.html'">Voltar</button>
                </form>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        
        <script>
            function validarCPF(cpf) {
                cpf = cpf.replace(/\D/g, '');
                
                if (cpf.length !== 11) return false;
                
                if (/^(\d)\1{10}$/.test(cpf)) return false;
                
                let soma = 0;
                for (let i = 0; i < 9; i++) {
                    soma += parseInt(cpf.charAt(i)) * (10 - i);
                }
                let resto = (soma * 10) % 11;
                if (resto === 10 || resto === 11) resto = 0;
                if (resto !== parseInt(cpf.charAt(9))) return false;
                
                soma = 0;
                for (let i = 0; i < 10; i++) {
                    soma += parseInt(cpf.charAt(i)) * (11 - i);
                }
                resto = (soma * 10) % 11;
                if (resto === 10 || resto === 11) resto = 0;
                if (resto !== parseInt(cpf.charAt(10))) return false;
                
                return true;
            }

            const cpfInput = document.getElementById('cpf');
            cpfInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length <= 11) {
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                    e.target.value = value;
                }
                
                cpfInput.classList.remove('is-invalid');
                const errorMsg = document.getElementById('cpfError');
                if (errorMsg) errorMsg.remove();
                
                checkFormValidity();
            });

            cpfInput.addEventListener('blur', function(e) {
                const cpfValue = e.target.value.replace(/\D/g, '');
                if (cpfValue.length > 0 && !validarCPF(cpfValue)) {
                    cpfInput.classList.add('is-invalid');
                    if (!document.getElementById('cpfError')) {
                        const errorDiv = document.createElement('div');
                        errorDiv.id = 'cpfError';
                        errorDiv.className = 'text-danger';
                        errorDiv.style.fontSize = '13px';
                        errorDiv.style.marginTop = '5px';
                        errorDiv.textContent = 'CPF inválido. Por favor, verifique o número digitado.';
                        cpfInput.parentElement.appendChild(errorDiv);
                    }
                    checkFormValidity();
                }
            });

            const radioOptions = document.querySelectorAll('.radio-option');
            const radioInputs = document.querySelectorAll('input[name="contactMethod"]');
            
            radioOptions.forEach((option, index) => {
                option.addEventListener('click', function() {
                    radioInputs[index].checked = true;
                    updateRadioSelection();
                    checkFormValidity();
                });
            });

            radioInputs.forEach(input => {
                input.addEventListener('change', function() {
                    updateRadioSelection();
                    checkFormValidity();
                });
            });

            function updateRadioSelection() {
                radioOptions.forEach(option => {
                    option.classList.remove('selected');
                });
                
                const selectedRadio = document.querySelector('input[name="contactMethod"]:checked');
                if (selectedRadio) {
                    selectedRadio.closest('.radio-option').classList.add('selected');
                }
            }

            function checkFormValidity() {
                const cpfValue = cpfInput.value.replace(/\D/g, '');
                const selectedMethod = document.querySelector('input[name="contactMethod"]:checked');
                const continueBtn = document.getElementById('continueBtn');
                const isCPFValid = validarCPF(cpfValue);
                
                if (cpfValue.length === 11 && isCPFValid && selectedMethod) {
                    continueBtn.classList.add('active');
                    continueBtn.disabled = false;
                } else {
                    continueBtn.classList.remove('active');
                    continueBtn.disabled = true;
                }
            }

            document.getElementById('resetPasswordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const cpfValue = cpfInput.value.replace(/\D/g, '');
                const selectedMethod = document.querySelector('input[name="contactMethod"]:checked');
                
                if (!validarCPF(cpfValue)) {
                    cpfInput.classList.add('is-invalid');
                    if (!document.getElementById('cpfError')) {
                        const errorDiv = document.createElement('div');
                        errorDiv.id = 'cpfError';
                        errorDiv.className = 'text-danger';
                        errorDiv.style.fontSize = '13px';
                        errorDiv.style.marginTop = '5px';
                        errorDiv.textContent = 'CPF inválido. Por favor, verifique o número digitado.';
                        cpfInput.parentElement.appendChild(errorDiv);
                    }
                    cpfInput.focus();
                    return;
                }
                
                if (!selectedMethod) {
                    alert('Por favor, selecione um método de contato.');
                    return;
                }
                
                const cpfFormatted = cpfInput.value;
                const methodText = selectedMethod.value === 'sms' ? 'SMS' : 'E-mail';
                
                alert(`✓ Validado com sucesso!\n\nCPF: ${cpfFormatted}\nMétodo de contato: ${methodText}\n\nCódigo de verificação enviado!`);
            });
        </script>

    </body>
</html>